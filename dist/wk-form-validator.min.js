"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var WKFormItem=function(){function e(t){_classCallCheck(this,e);var r=["radio","checkbox","text","file","date","number","email","password","tel"],a=["input","textarea","select"];if(!t||!this.isElement(t))throw new Error("Provided element is not a valid DOM Element");if(!a.includes(t.tagName.toLowerCase()))throw new Error("Provided DOM Element is currently not supported (supported elements: "+a.join(", ")+")");if("INPUT"==t.tagName&&!r.includes(t.getAttribute("type")))throw new Error("Proveded Form Input type is currently not supported (supported types: "+r.join(", ")+")");this.tagName=t.tagName.toLowerCase(),"input"==this.tagName?this.type=t.getAttribute("type"):this.type=this.tagName,this.name=t.getAttribute("name"),"radio"==this.type?this.DOM_NODE=document.querySelectorAll("input[type=radio][name="+this.name+"]"):this.DOM_NODE=t}return _createClass(e,[{key:"addClass",value:function(e){if("radio"==this.type)for(var t=0;t<this.DOM_NODE.length;t++)this.DOM_NODE[t].classList.add(e);else this.DOM_NODE.classList.add(e)}},{key:"removeClass",value:function(e){if("radio"==this.type)for(var t=0;t<this.DOM_NODE.length;t++)this.DOM_NODE[t].classList.remove(e);else this.DOM_NODE.classList.remove(e)}},{key:"value",value:function(){if("radio"!=this.type)return this.DOM_NODE.value;for(var e=0;e<this.DOM_NODE.length;e++)this.DOM_NODE[e].checked&&"on"!=this.DOM_NODE[e].value&&"off"!=this.DOM_NODE[e].value&&this.DOM_NODE[e].value}},{key:"isElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument}}]),e}(),WKFormValidator=function(){function e(t,r){var a=this;if(_classCallCheck(this,e),this.isElement(t))this.$form=t;else{var n=document.querySelector(t);if(!n)throw new Error("Cannot find HTML Element with given selector");this.$form=n}if(this.$form.addEventListener("submit",function(e){"true"!=a.$form.getAttribute("data-wkvalid")&&(e.preventDefault(),a.validate())}),!r||"object"!=(void 0===r?"undefined":_typeof(r)))throw new Error("Missing configuration object or given data is not an object");r.hasOwnProperty("inputErrorClass")&&"string"==typeof r.inputErrorClass?this.$inputErrorClass=r.inputErrorClass:this.$inputErrorClass="incorrect",r.hasOwnProperty("inputMsgBoxSelectorPattern")&&"string"==typeof r.inputMsgBoxSelectorPattern?this.$inputMsgBoxSelectorPattern=r.inputMsgBoxSelectorPattern:this.$inputMsgBoxSelectorPattern=".%{name}-incorrect-msg",r.hasOwnProperty("inputMsgBoxClass")&&"string"==typeof r.inputMsgBoxClass?this.$inputMsgBoxClass=r.inputMsgBoxClass:this.$inputMsgBoxClass="incorrect-msg",r.hasOwnProperty("inputMsgBoxActiveClass")&&"string"==typeof r.inputMsgBoxActiveClass?this.$inputMsgBoxActiveClass=r.inputMsgBoxActiveClass:this.$inputMsgBoxActiveClass="active",r.hasOwnProperty("validationErrorCallback")&&"function"==typeof r.validationErrorCallback?this.$validationErrorCallback=r.validationErrorCallback:this.$validationErrorCallback=null,r.hasOwnProperty("schema")&&"object"==_typeof(r.schema)?this.$schema=Object.entries(r.schema):this.$schema=[],this.$inputs={};for(var s=0;s<this.$form.elements.length;s++){var o=this.$form.elements[s],i=void 0;if("radio"!=o.getAttribute("type")||!this.$inputs.hasOwnProperty(this.caseConverter(o.getAttribute("name"))))try{i=new WKFormItem(o),this.$inputs[this.caseConverter(i.name)]=i}catch(e){continue}}}return _createClass(e,[{key:"validate",value:function(){var e=this;this.cleanErrors();var t=!1;this.$schema.forEach(function(r){var a=r[0],n=r[1];if(e.$inputs.hasOwnProperty(a)){var s=e.$inputs[a],o=[],i=!1;if(n.hasOwnProperty("required"))if(!0===n.required||"object"==_typeof(n.required)&&n.required.hasOwnProperty("value")&&!0===n.required.value){var l=!1;if("radio"==s.type){for(var u=!1,c=0;c<s.DOM_NODE.length;c++)if(!0===s.DOM_NODE[c].checked){u=!0;break}u||(l=!0)}else"checkbox"==s.type?s.DOM_NODE.checked||(l=!0):""==s.value()&&(l=!0);l&&(i=!0,"object"==_typeof(n.required)&&n.required.hasOwnProperty("msg")&&o.push(n.required.msg))}else console.error("Presence test value for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly.");if("textarea"==s.tagName||"input"==s.tagName&&"radio"!=s.type&&"checkbox"!=s.type){if(n.hasOwnProperty("minLength")){var p=!1;"number"==typeof n.minLength&&n.minLength>=0?s.value().split("").length<n.minLength&&(p=!0):"object"==_typeof(n.minLength)&&n.minLength.hasOwnProperty("value")&&"number"==typeof n.minLength.value&&n.minLength.value>=0?s.value().split("").length<n.minLength.value&&(p=!0,n.minLength.hasOwnProperty("msg")&&o.push(n.minLength.msg)):console.error("MinLength test value for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly."),p&&(i=!0)}if(n.hasOwnProperty("maxLength")){var h=!1;"number"==typeof n.maxLength&&n.maxLength>0?s.value().split("").length>n.maxLength&&(h=!0):"object"==_typeof(n.maxLength)&&n.maxLength.hasOwnProperty("value")&&"number"==typeof n.maxLength.value&&n.maxLength.value>0?s.value().split("").length>n.maxLength.value&&(h=!0,n.maxLength.hasOwnProperty("msg")&&o.push(n.maxLength.msg)):console.error("MaxLength test value for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly."),h&&(i=!0)}if(n.hasOwnProperty("pattern")){var m=!1,v=null;"object"==_typeof(n.pattern)&&n.pattern instanceof RegExp?v=n.pattern:"object"==_typeof(n.pattern)&&n.pattern.hasOwnProperty("value")&&"object"==_typeof(n.pattern.value)&&n.pattern.value instanceof RegExp?(v=n.pattern.value,n.pattern.hasOwnProperty("msg")&&(m=!0)):console.error("Pattern test value for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly.");try{(v=new RegExp(v)).test(s.value())||(i=!0,m&&o.push(n.pattern.msg))}catch(e){console.error("Regular expression passed to test input with name "+s.name+" is incorrect, check error message below:"),console.error(e)}}if(n.hasOwnProperty("exactValue")){var f=!1,y=null,g=!1,d=!1;"string"==typeof n.exactValue?y=n.exactValue:"object"==_typeof(n.exactValue)&&n.exactValue.hasOwnProperty("value")&&"string"==typeof n.exactValue.value?(y=n.exactValue.value,n.exactValue.hasOwnProperty("msg")&&(f=!0),n.exactValue.hasOwnProperty("caseSensitive")&&!1===n.exactValue.caseSensitive&&(g=!0),n.exactValue.hasOwnProperty("varSyntax")&&"string"==typeof n.exactValue.varSyntax&&(d=n.exactValue.varSyntax)):console.error("ExactValue test value for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly.");var x=e.varExtractor(y,d);if(x.length>0)for(var O=0;O<x.length;O++)y=y.replace(x[O].value,e.$inputs[e.caseConverter(x[O].varName)].value());var w=s.value();g&&(w=w.toLowerCase(),y=y.toLowerCase()),y!=w&&(i=!0,f&&o.push(n.exactValue.msg))}}if("input"==s.tagName&&"number"==s.type){if(n.hasOwnProperty("min")){var b=!1;"number"==typeof n.min&&n.min>=0?s.value()<n.min&&(b=!0):"object"==_typeof(n.min)&&n.min.hasOwnProperty("value")&&"number"==typeof n.min.value&&n.min.value>=0?s.value()<n.min.value&&(b=!0,n.min.hasOwnProperty("msg")&&o.push(n.min.msg)):console.error("Min test for number input for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly."),b&&(i=!0)}if(n.hasOwnProperty("max")){var E=!1;"number"==typeof n.max&&n.max>0?s.value()>n.max&&(E=!0):"object"==_typeof(n.max)&&n.max.hasOwnProperty("value")&&"number"==typeof n.max.value&&n.max.value>0?s.value()>n.max.value&&(E=!0,n.max.hasOwnProperty("msg")&&o.push(n.max.msg)):console.error("Max test for number input for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly."),E&&(i=!0)}if(n.hasOwnProperty("step")){var P=!1;"number"==typeof n.step&&n.step>0?s.value()%n.step!=0&&(P=!0):"object"==_typeof(n.step)&&n.step.hasOwnProperty("value")&&"number"==typeof n.step.value&&n.step.value>0?s.value()%n.step.value!=0&&(P=!0,n.step.hasOwnProperty("msg")&&o.push(n.step.msg)):console.error("Step test for number input for input with name "+s.name+" is incorrect. Please check documentation how to build schema ocject properly."),P&&(i=!0)}}i&&(e.displayError(s.name,o.join(", ")),t=!0)}}),t?this.$validationErrorCallback&&this.$validationErrorCallback():(this.$form.setAttribute("data-wkvalid",!0),this.$form.submit())}},{key:"displayError",value:function(e,t){this.$inputs[this.caseConverter(e)].addClass(this.$inputErrorClass);var r=document.querySelector(this.$inputMsgBoxSelectorPattern.replace("%{name}",e));r&&(t&&""!=t&&(r.innerText=t),r.classList.add(this.$inputMsgBoxActiveClass))}},{key:"cleanErrors",value:function(){for(var e=this.$form.querySelectorAll("."+this.$inputMsgBoxClass+"."+this.$inputMsgBoxActiveClass),t=0;t<e.length;t++)e[t].classList.remove(this.$inputMsgBoxActiveClass);for(var r in this.$inputs)this.$inputs[r].removeClass(this.$inputErrorClass)}},{key:"caseConverter",value:function(e){for(e=(e=(e=e.replace(/[^A-z0-9-_]/g,"")).replace(/[-]+/g,"-")).split("");"-"==e[e.length-1];)e.pop();if(0==(e=e.join("")).search(/[0-9]/))throw new Error("Input name is invalid, digit is not allowed as a first character");for(;-1!=e.indexOf("-");){var t=e.indexOf("-");e=(e=e.replace("-","")).substr(0,t)+e.slice(t,t+1).toUpperCase()+e.substr(t+1)}return e}},{key:"varExtractor",value:function(e,t){var r="%{",a="}",n=[];if(t&&"string"==typeof t&&-1!=t.indexOf("#")){var s=t.indexOf("#");r=t.substring(0,s),a=t.substring(s+1)}for(var o=0;-1!=e.indexOf(r,o);){o=e.indexOf(r,o);var i=e.indexOf(a,o);n.push({value:e.slice(o,i+1),varName:e.slice(o+r.split("").length,i),start:o,end:i}),o=i+1}return n}},{key:"isElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument}}]),e}();